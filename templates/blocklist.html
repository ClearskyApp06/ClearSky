{% extends "base.html" %}

{% block content %}
    <div id="block-list-container">
        <div id="block-list">
            <h1>Block List</h1>
            <h2 id="user-heading">{{ user }}</h2>
            <h3 id="block-count">Number of accounts blocking: {{ count }}</h3>
            <table>
                <tr>
                    <th class="handle">Handle</th>
                    <th class="date">Date</th>
                </tr>
                {% for item in blocklist %}
                <tr>
                    <td class="handle">
                        {% if item.status %}
                        <a href="https://bsky.app/profile/{{ item.handle }}" target="_blank">{{ item.handle }}</a>
                        {% else %}
                        {{ item.handle }}
                        {% endif %}
                    </td>
                    <td class="date" data-utc-timestamp="{% if item.blocked_date % }{{ item.blocked_date.timestamp() }}{% else %}None{% endif %}">{{ item.blocked_date }}</td>
                </tr>
                {% endfor %}
            </table>

            <!-- Pagination controls -->
            <div class="pagination">
                {% if page > 1 %}
                    <a href="{{ url_for('blocklist', identifier=identifier, page=page-1, from='previous') }}" class="prev">Previous</a>
                {% endif %}
                {% if more_data_available %}
                    <a href="{{ url_for('blocklist', identifier=identifier, page=page+1, from='next') }}" class="next">Next</a>
                {% endif %}
            </div>
        </div>
        <a href="/" class="btn btn-primary" id="go-back-button">Go Back</a>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Get all elements with the data-utc-timestamp attribute
            const utcTimestampElements = document.querySelectorAll("[data-utc-timestamp]");

            utcTimestampElements.forEach(function (element) {
                const utcTimestamp = parseFloat(element.getAttribute("data-utc-timestamp") * 1000); // Convert to milliseconds
                const localDate = new Date(utcTimestamp);

                // Format the local date as desired (e.g., 'YYYY-MM-DD hh:mm:ss a')
                const localDateString = localDate.toLocaleString();

                // Update the content of the element with the local date
                element.textContent = localDateString;
            });
        });
    </script>
{% endblock %}
